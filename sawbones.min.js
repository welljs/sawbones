wellDefine("Plugins:Sawbones:Collections",function(){this.exports(function(){var t=function(){};return _.extend(t.prototype,{storage:{},get:function(t){return this.storage[t]},set:function(t,e){this.storage[t]=e}}),new t})}),wellDefine("Plugins:Sawbones:Main",function(t){this.use(":Views",{autoInit:!1}),this.use(":Templates",{autoInit:!1}),this.use(":Collections",{autoInit:!1}),this.use(":Models",{autoInit:!1}),this.use(":Router",{autoInit:!1}),this.use(":PageView",{autoInit:!1}),this.exports(function(){t.Events=_.extend(Backbone.Events,{}),t.Templates=new this.Templates,t.PageProto=new this.PageView,t.Views=new this.Views,t.Router=this.Router(),t.Models=new this.Models,t.Collections=new this.Collections})}),wellDefine("Plugins:Sawbones:Models",function(t){this.exports(function(){var e=function(){this.initialized={},this.modules={},this.config={},t.on("MODULE_DEFINED",this.onModuleDefined,this)};return e.prototype.onModuleDefined=function(t){t.isModel&&this.set(t)},e.prototype.get=function(t){return this.modules[t].exportsFn()},e.prototype.set=function(t){this.modules[t.name]=t},new e})}),wellDefine("Plugins:Sawbones:PageView",function(t){this.exports(function(){return Backbone.View.extend({setTemplate:function(e){this.template=t.Templates.get(e)},requestData:function(t,e){e()},render:function(){this.$el.html(this.template.render())},onPageLeave:function(){}})})}),wellDefine("Plugins:Sawbones:Router",function(t){this.exports(function(){return new(Backbone.Router.extend({currentPage:null,initialize:function(){this.config={defaultPage:"/"}},defineRoutes:function(t){var e=this;return this.route(/(.*)/,function(){return e.go("/"),this}),_.each(t,function(t){this.route(t,"proxy")},this),this},proxy:function(){var e=Array.prototype.slice.call(arguments),n=this.parseUrl(Backbone.history.fragment,e),i=this;this.accessPage(n,e,function(o,r){return o?i.go(r||i.currentPage||i.config.defaultPage):(i.currentPage=n,t.Events.trigger("ROUTER_PAGE_CHANGED",i.getRouteAction(n),{route:n,params:e}),void(i.customLayout=null))})},accessPage:function(t,e,n){n()},go:function(t,e){e&&(this.customLayout=e.layout),Backbone.history.navigate(t,{trigger:!0})},configure:function(t){return this.config=t,this.config.pushState=t.pushState||!1,this.defineRoutes(t.routes),this.beforeStart=t.beforeStart||function(){},this},start:function(){_.isFunction(this.beforeStart)&&this.beforeStart(),Backbone.history.start({pushState:this.config.pushState})},getRouteAction:function(t){var e=this.config.actions[t];return this.customLayout?_.isObject(e)?e.layout=this.customLayout:{page:e,layout:this.customLayout}:e},parseUrl:function(t){var e=t.split("/");return e[0]?"/"+e[0]:"/"}}))})}),wellDefine("Plugins:Sawbones:Templates",function(t){this.exports(function(){function e(t){return{path:t.path,render:function(e){return t.renderer(e)}}}var n=function(){this.storage={},this.config={},this.defaults={},this._start()};return _.extend(n.prototype,{configure:function(t){return this.config=t,this},_start:function(){return t.isProduction&&this._processCompiled(),this},get:function(t){return this.storage[t]},exist:function(t){return!!this.storage[t]},registerPartial:function(e){return e.html||e.templateName?void(t.isProduction?Handlebars.partials[e.partialName]=Handlebars.templates[t.transformToPath(e.templateName)]:Handlebars.registerPartial(e.partialName||e.templateName,e.html||this.get(e.templateName).render())):console.log("error: ","no html")},isNotFound:function(t){return-1!==t.indexOf("NotFound")||-1!==t.indexOf("not-found")},load:function(t,e,n){n=n||{},_.isString(t)&&(t=[t]);var i=_.filter(t,function(t){return!this.exist(t)},this),o=[];_.each(i,function(t){o.push(this.getAjax(t,n))},this),$.when.apply($,o).then(_.isFunction(e)&&e)},getAjax:function(n,i){var o=(i.root||this.config.root||"/")+t.transformToPath(n);return $.ajax({url:o+".html",dataType:"html",context:this,success:function(t){var i=e({path:o,renderer:Handlebars.compile(t)});this.storage[n]=i},error:function(t){console.error(t)}})},_processCompiled:function(){var n=Handlebars.templates;for(var i in n)n.hasOwnProperty(i)&&(this.storage[t.transformToName(i)]=e({path:i,renderer:n[i]}));return this}}),new n})}),wellDefine("Plugins:Sawbones:Views",function(t){this.exports(function(){var e=function(){t.Events.on("ROUTER_PAGE_CHANGED",this.tryToRender,this),t.on("MODULE_DEFINED",this.onModuleDefined,this)};return _.extend(e.prototype,{initialized:{},modules:{},config:{},currentLayout:null,currentPage:null,configure:function(t){this.config=t},get:function(e){return t.Modules.getModule(e).exportsFn()},getModule:function(e){return t.Modules.getModule(e)},getConfigParam:function(t){return this.config[t]},getPartials:function(t){if(t){var e=_.isString(t)?this.getModule(t):t;return e.get("partials")||[]}},getTemplate:function(e){if(e){var n=_.isString(e)?this.getModule(e):e,i=n.get("template");return t.Templates.get(i)||i}},onModuleDefined:function(t){this.isView(t)&&this.complete(t)},isView:function(t){return"view"===t.get("type")||-1!==t.name.indexOf("View")},isCurrentLayout:function(t){return!(!this.currentLayout||this.currentLayout.name!==t)},complete:function(e){function n(){e.isComplete=!0,t.Events.trigger("MODULE_COMPLETED",e)}if(t.isProduction)return n();var i=[],o=this.getTemplate(e);return o&&i.push(e.get("template")),_.each(this.getPartials(e),function(t){i.push(t)},this),_.isEmpty(i)?n():(e.isComplete=!1,void t.Templates.load(i,function(){return n()}))},getIncomplete:function(t){var e=[];return _.each(t,function(t){this.isView(t)&&t.get("template")&&!t.isComplete&&e.push(t.name)},this),e},waitOnQueueComplete:function(e,n){var i=this.getIncomplete(e);return _.isEmpty(i)?n.call(this):void t.Events.on("MODULE_COMPLETED",function(e){var o=i.indexOf(e.name);return-1===o||(i.splice(o,1),i.length)?void 0:(t.Events.off("MODULE_COMPLETED"),n.call(this))},this)},tryToRender:function(e,n){var i,o,r,s,u,a=this;if(this.showOverlay(),_.isString(e)?(s=this.getConfigParam("layoutModule")||":Defaults:Layout",u=e):e?!e.page&&e.layout?(s=e.layout,u=this.getConfigParam("notFoundModule")||":Defaults:NotFound"):(s=e.layout||this.getConfigParam("layoutModule")||":Defaults:Layout",u=e.page):(s=this.getConfigParam("layoutModule")||":Defaults:Layout",u=this.getConfigParam("notFoundModule")||":Defaults:NotFound"),o=this.getModule(s),!o)return t.require([s],function(t,i){a.waitOnQueueComplete(i,function(){a.tryToRender(e,n)})});if(!o.isComplete)return(r={})[o.name]=o,this.waitOnQueueComplete(r,function(){a.tryToRender(e,n)});if(i=this.getModule(u),!i)return t.require([u],function(t,i){a.waitOnQueueComplete(i,function(){a.tryToRender(e,n)})},function(){return a.getModule("Well:Defaults:NotFound")?void t.Router.go("not-found"):t.require(["Well:Defaults:NotFound"],function(t,e){a.waitOnQueueComplete(e,function(){a.tryToRender("Well:Defaults:NotFound",n)})})});if(!i.isComplete)return(r={})[i.name]=i,this.waitOnQueueComplete(r,function(){a.tryToRender(e,n)});this.currentPage&&t.Events.trigger("PAGE_LEAVE",this.currentPage.view),t.Events.trigger("BEFORE_PAGE_RENDERED",{page:i,layout:o,params:n.params}),this.renderLayout.apply(this,[o,n.params]);var l=this.getInitialized(i);return l.requestData(n.params,function(){a.renderPage.apply(a,[i,n.params]),a.hideOverlay(),t.Events.trigger("PAGE_RENDERED",{page:i,layout:o,params:n.params})}),this},renderPage:function(t,e){return this.currentPage=t,t.el=this.currentLayout.view.pageContainer,this.currentPage.view=this._render(t,e)},renderLayout:function(t,e){return this.isCurrentLayout(t.name)?this.currentLayout.view:(this.currentLayout=t,t.el=$(this.config.layoutHolder||"body"),this.currentLayout.view=this._render(t,e))},_render:function(t,e){var n=this.getInitialized(t);return _.isFunction(n.render)&&n.render.apply(n,e),n},getInitialized:function(t){var e=this.initialized[t.name]||this.initialize(t);return e.$el=t.el,e},initialize:function(t,e){var n=_.isString(t)?this.getModule(t):t;if(!n)throw"View module "+t+" not found";var i=this.getTemplate(n),o=n.name,r=this.initialized[o]=new(this.get(o))(_.extend({template:i,el:n.el},e));return r.template=i,r.module=n,r},showOverlay:function(){this.isOverlayVisible=!0},hideOverlay:function(){this.isOverlayVisible=!1}}),new e})});