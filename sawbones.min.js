wellDefine("Plugins:Sawbones:Collections",function(){this.exports(function(){var t=function(){};return _.extend(t.prototype,{storage:{},get:function(t){return this.storage[t]},set:function(t,e){this.storage[t]=e}}),new t})}),wellDefine("Plugins:Sawbones:Models",function(t){this.exports(function(){var e=function(){this.initialized={},this.modules={},this.config={},t.Modules.on("MODULE_DEFINED",this.onModuleDefined,this)};return e.prototype.onModuleDefined=function(t){t.isModel&&this.set(t)},e.prototype.get=function(t){return this.modules[t].exportFn()},e.prototype.set=function(t){this.modules[t.name]=t},new e})}),wellDefine("Plugins:Sawbones:PageView",function(t){this.exports(function(e){var e=e||{},n=e.extendedFrom||Backbone.View;return n.extend({setTemplate:function(e){this.template=t.Templates.get(e)}})})}),wellDefine("Plugins:Sawbones:Router",function(t){this.exports(function(){return Backbone.Router.extend({currentPage:null,initialize:function(){this.config={}},defineRoutes:function(t){var e=this;return _.each(t,function(t){this.route(t,"proxy")},this),Backbone.history.handlers.push({route:/(.*)/,callback:function(){return e.go("/"),this}}),this},proxy:function(){"undefined"!=typeof _gaq&&_.isArray(_gaq)&&_gaq.push(["_trackPageview",Backbone.history.root+Backbone.history.getFragment()]);var e=this.parseUrl(Backbone.history.fragment);this.currentPage="/"===e.route?"":e.route,t.Events.trigger("ROUTER_PAGE_CHANGED",this.getRouteAction(e.route),{route:e.route,params:e.params}),this.customLayout=null},go:function(t,e){e&&(this.customLayout=e.layout),Backbone.history.navigate(t,{trigger:!0})},configure:function(t){return this.config=t,this.config.pushState=t.pushState||!1,this.defineRoutes(t.routes),this.beforeStart=t.beforeStart||function(){},this},start:function(){_.isFunction(this.beforeStart)&&this.beforeStart(),Backbone.history.start({pushState:this.config.pushState})},getRouteAction:function(t){var e=this.config.actions[t];return this.customLayout?_.isObject(e)?e.layout=this.customLayout:{page:e,layout:this.customLayout}:e},parseUrl:function(t){var e=t.split("/");return{route:e[0]?"/"+e[0]:"/",params:e[1]||""}}})})}),wellDefine("Plugins:Sawbones:Templates",function(t){this.exports(function(){function e(t){return{path:t.path,render:function(e){return t.renderer(e)}}}var n=function(){this.storage={},this.config={},this.defaults={},this._start()};return _.extend(n.prototype,{configure:function(t){return this.config=t,this},_start:function(){return t.isProduction&&this._processCompiled(),this._registerHelpers(),this},get:function(t){return this.storage[t]},exist:function(t){return this.storage[t]},registerPartial:function(e){t.isProduction?Handlebars.partials[e.partialName]=Handlebars.templates[t.transformToPath(e.templateName)]:Handlebars.registerPartial(e.partialName,e.html)},isNotFound:function(t){return-1!==t.indexOf("NotFound")||-1!==t.indexOf("not-found")},load:function(t,e,n){var i=_.filter(t,function(t){return!this.exist(t.name)},this),o=[];_.each(i,function(t){o.push(this.getAjax(t.path,t.name,n))},this),$.when.apply($,o).then(_.isFunction(e)&&e)},getAjax:function(n,i,o){return $.ajax({url:n+".html",dataType:"html",context:this,success:function(o){var r=e({path:n,renderer:Handlebars.compile(o)});this.storage[t.transformToName(i)]=r},error:function(t){_.isFunction(o)&&o(t)}})},_processCompiled:function(){var n=Handlebars.templates;for(var i in n)n.hasOwnProperty(i)&&(this.storage[t.transformToName(i)]=e({path:i,renderer:n[i]}));return this},_registerHelpers:function(){return Handlebars.registerHelper("partial",function(e){var n=t.Views.isInitialized(e)?t.Views.getInitialized(e):t.Views.initialize(e);return n?n.$el.html():""}),this},getHtmlPath:function(t){return t.getOption("isDefault")?"/":this.config.html||"/"}}),new n})}),wellDefine("Plugins:Sawbones:Views",function(t){this.exports(function(){var e=function(){t.Events.on("ROUTER_PAGE_CHANGED",this.tryToRender,this),t.Modules.on("MODULE_DEFINED",this.onModuleDefined,this)};return _.extend(e.prototype,{initialized:{},modules:{},config:{},currentLayout:null,currentPage:null,configure:function(t){this.config=t},get:function(e){return t.Modules.getModule(e).exportFn()},getModule:function(e){return t.Modules.getModule(e)},getConfigParam:function(t){return this.config[t]},getPartials:function(t){if(t){var e=_.isString(t)?this.getModule(t):t;return e.getOption("partials")||[]}},getTemplate:function(e){if(e){var n=_.isString(e)?this.getModule(e):e,i=n.getOption("template");return t.Templates.get(i)||i}},onModuleDefined:function(t){t.isView&&this.complete(t)},isCurrentLayout:function(t){return!(!this.currentLayout||this.currentLayout.name!==t)},complete:function(e){function n(){e.isComplete=!0,t.Events.trigger("MODULE_COMPLETED",e)}if(t.isProduction)return n();var i=[],o=this.getTemplate(e);return o&&i.push({name:o,path:this.getHtmlPath(e)+t.transformToPath(e.getOption("template"))}),_.each(this.getPartials(e),function(n){i.push({name:n,path:this.getHtmlPath(e)+t.transformToPath(n)})},this),_.isEmpty(i)?n():void t.Templates.load(i,function(){return n()})},getIncomplete:function(t){var e=[];return _.each(t,function(t){t.isComplete||e.push(t.name)}),e},waitOnQueueComplete:function(e,n){var i=this.getIncomplete(e);_.isEmpty(i)||t.Events.on("MODULE_COMPLETED",function(e){var o=i.indexOf(e.name);return-1===o||(i.splice(o,1),i.length)?void 0:(t.Events.off("MODULE_COMPLETED"),n.call(this))},this)},tryToRender:function(e,n){var i,o,r,u,s,a=this;return this.showOverlay(),_.isString(e)?(u=this.getConfigParam("layoutModule")||"Well:Defaults:Layout",s=e):e?!e.page&&e.layout?(u=e.layout,s=this.getConfigParam("notFoundModule")||"Well:Defaults:NotFound"):(u=e.layout||this.getConfigParam("layoutModule")||"Well:Defaults:Layout",s=e.page):(u=this.getConfigParam("layoutModule")||"Well:Defaults:Layout",s=this.getConfigParam("notFoundModule")||"Well:Defaults:NotFound"),(o=this.getModule(u))?o.isComplete?(i=this.getModule(s))?i.isComplete?(t.Events.trigger("BEFORE_PAGE_RENDERED",{page:i,layout:o,params:n}),this.renderLayout(o,n),this.renderPage(i,n),this.hideOverlay(),t.Events.trigger("PAGE_RENDERED",{page:i,layout:o,params:n}),this):((r={})[i.name]=i,this.waitOnQueueComplete(r,function(){a.tryToRender(e,n)})):t.Modules.require([s],function(t){a.waitOnQueueComplete(t,function(){a.tryToRender(e,n)})},function(){return a.getModule("Well:Defaults:NotFound")?void t.Router.go("not-found"):t.Modules.require(["Well:Defaults:NotFound"],function(t){a.waitOnQueueComplete(t,function(){a.tryToRender("Well:Defaults:NotFound",n)})})}):((r={})[o.name]=o,this.waitOnQueueComplete(r,function(){a.tryToRender(e,n)})):t.Modules.require([u],function(t){a.waitOnQueueComplete(t,function(){a.tryToRender(e,n)})})},renderPage:function(t,e){return this.currentPage=t,t.el=this.currentLayout.view.pageContainer,this.render(t,e)},renderLayout:function(t,e){return this.isCurrentLayout(t.name)?this.currentLayout.view:(this.currentLayout=t,t.el=$(this.config.layoutHolder||"body"),this.currentLayout.view=this.render(t,e))},render:function(t,e){var n=this.isInitialized(t.name)?this.getInitialized(t):this.initialize(t);return _.isFunction(n.render)&&n.render(e),n},getInitialized:function(t){var e=this.initialized[t.name];return e.$el=t.el,e},initialize:function(t,e){var n=_.isString(t)?this.getModule(t):t;if(!n)throw"View module "+t+" not found";var i=this.getTemplate(n),o=n.name,r=this.initialized[o]=new(this.get(o))(_.extend({template:i,el:n.el},e));return r.template=i,r},isInitialized:function(t){return!!this.initialized[t]},showOverlay:function(){this.isOverlayVisible=!0},hideOverlay:function(){this.isOverlayVisible=!1},getHtmlPath:function(t){return t.getOption("isDefault")?"/":this.config.templates||"/"}}),new e})});